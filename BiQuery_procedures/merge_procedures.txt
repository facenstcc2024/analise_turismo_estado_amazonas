#####################

Apos Abrir o Big Query, no menu vertical a esquerdam clique na primeira opção big query Studio, 
e abra uma aba de consulta SQL .
Na aba de consulta SQL executar cada bloco de codigo abaixo,
para criar as procedures de carga e tratamento de dados das tabelas intermediarias para 
as tabelas finais

#####################

CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_d_Agua`()
BEGIN


MERGE `tccfacens2024.TCC_Turismo.d_Agua` tgt
USING (SELECT NO_MUNICIPIO,
cast(ANO_REF as Integer) as ANO_REF,
cast(AGUA_POPULACAO_ATEND_QT as Integer) as AGUA_POPULACAO_ATEND_QT 
FROM `tccfacens2024.TCC_Turismo_staging.d_Agua` ) as src
ON
  tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO and 
  tgt.ANO_REF  = src.ANO_REF and 
  tgt.AGUA_POPULACAO_ATEND_QT  = src.AGUA_POPULACAO_ATEND_QT 

WHEN MATCHED THEN
  UPDATE SET 
    tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO,
    tgt.ANO_REF  = src.ANO_REF,
    tgt.AGUA_POPULACAO_ATEND_QT  = src.AGUA_POPULACAO_ATEND_QT 
  
WHEN NOT MATCHED BY TARGET THEN
  INSERT (
    NO_MUNICIPIO ,
    ANO_REF ,
    AGUA_POPULACAO_ATEND_QT  )
  VALUES (
    src.NO_MUNICIPIO ,
    src.ANO_REF ,
    src.AGUA_POPULACAO_ATEND_QT 
    );
    
DELETE FROM `tccfacens2024.TCC_Turismo_staging.d_Agua` WHERE 1 = 1 ;
END;



#############################



CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_d_Ensino_Basico`()
BEGIN


MERGE `tccfacens2024.TCC_Turismo.d_Ensino_Basico` tgt
USING (SELECT NO_MUNICIPIO,
cast(QT_MAT_BAS as Integer) as QT_MAT_BAS
FROM `tccfacens2024.TCC_Turismo_staging.d_Ensino_Basico` ) as src
ON
  tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO and 
  tgt.QT_MAT_BAS  = src.QT_MAT_BAS 

WHEN MATCHED THEN
  UPDATE SET 
    tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO,
    tgt.QT_MAT_BAS  = src.QT_MAT_BAS
  
WHEN NOT MATCHED BY TARGET THEN
  INSERT (
    NO_MUNICIPIO ,
    QT_MAT_BAS  )
  VALUES (
    src.NO_MUNICIPIO ,
    src.QT_MAT_BAS 
    );
    
DELETE FROM `tccfacens2024.TCC_Turismo_staging.d_Ensino_Basico`  WHERE 1 = 1;
END;


#################################

CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_d_Ensino_Superior`()
BEGIN


MERGE `tccfacens2024.TCC_Turismo.d_Ensino_Superior` tgt
USING (
  SELECT 
    NO_MUNICIPIO,
    NO_CURSO,
    NO_CINE_ROTULO,
    NO_CINE_AREA_GERAL,
    NO_CINE_AREA_DETALHADA,
    NO_CINE_AREA_ESPECIFICA,
  cast(QT_MAT as Integer) as QT_MAT
  FROM `tccfacens2024.TCC_Turismo_staging.d_Ensino_Superior` ) as src
ON
  tgt.NO_MUNICIPIO = src.NO_MUNICIPIO	and
  tgt.NO_CURSO= src.NO_CURSO	and
  tgt.NO_CINE_ROTULO = src.NO_CINE_ROTULO and	
  tgt.NO_CINE_AREA_GERAL = src.NO_CINE_AREA_GERAL and	
  tgt.NO_CINE_AREA_DETALHADA = src.NO_CINE_AREA_DETALHADA and	
  tgt.NO_CINE_AREA_ESPECIFICA = src.NO_CINE_AREA_ESPECIFICA	and
  tgt.QT_MAT = src.QT_MAT	

WHEN MATCHED THEN
  UPDATE SET 
    tgt.NO_MUNICIPIO = src.NO_MUNICIPIO	,
    tgt.NO_CURSO= src.NO_CURSO	,
    tgt.NO_CINE_ROTULO = src.NO_CINE_ROTULO	,
    tgt.NO_CINE_AREA_GERAL = src.NO_CINE_AREA_GERAL	,
    tgt.NO_CINE_AREA_DETALHADA = src.NO_CINE_AREA_DETALHADA	,
    tgt.NO_CINE_AREA_ESPECIFICA = src.NO_CINE_AREA_ESPECIFICA	,
    tgt.QT_MAT = src.QT_MAT	
  
WHEN NOT MATCHED BY TARGET THEN
  INSERT (
    NO_MUNICIPIO ,
    NO_CURSO,
    NO_CINE_ROTULO,
    NO_CINE_AREA_GERAL,
    NO_CINE_AREA_DETALHADA,
    NO_CINE_AREA_ESPECIFICA,
    QT_MAT  )
  VALUES (
    src.NO_MUNICIPIO ,
    src.NO_CURSO ,
    src.NO_CINE_ROTULO ,
    src.NO_CINE_AREA_GERAL ,
    src.NO_CINE_AREA_DETALHADA ,
    src.NO_CINE_AREA_ESPECIFICA ,
    src.QT_MAT 
    );
    
DELETE FROM `tccfacens2024.TCC_Turismo_staging.d_Ensino_Superior` WHERE 1 = 1;
END;

############################################


CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_d_Ensino_Tecnico`()
BEGIN


MERGE `tccfacens2024.TCC_Turismo.d_Ensino_tecnico` tgt
USING (
  SELECT 
    NO_MUNICIPIO,
    NO_AREA_CURSO_PROFISSIONAL,
    NO_CURSO_EDUC_PROFISSIONAL,
  cast(QT_MAT_CURSO_TEC as Integer) as QT_MAT_CURSO_TEC
  FROM `tccfacens2024.TCC_Turismo_staging.d_Ensino_tecnico` ) as src
ON
  tgt.NO_MUNICIPIO = src.NO_MUNICIPIO	and
  tgt.NO_AREA_CURSO_PROFISSIONAL= src.NO_AREA_CURSO_PROFISSIONAL	and
  tgt.NO_CURSO_EDUC_PROFISSIONAL = src.NO_CURSO_EDUC_PROFISSIONAL and	
  tgt.QT_MAT_CURSO_TEC = src.QT_MAT_CURSO_TEC 

WHEN MATCHED THEN
  UPDATE SET 
    tgt.NO_MUNICIPIO = src.NO_MUNICIPIO	,
    tgt.NO_AREA_CURSO_PROFISSIONAL= src.NO_AREA_CURSO_PROFISSIONAL	,
    tgt.NO_CURSO_EDUC_PROFISSIONAL = src.NO_CURSO_EDUC_PROFISSIONAL	,
    tgt.QT_MAT_CURSO_TEC = src.QT_MAT_CURSO_TEC	
  
WHEN NOT MATCHED BY TARGET THEN
  INSERT (
    NO_MUNICIPIO ,
    NO_AREA_CURSO_PROFISSIONAL,
    NO_CURSO_EDUC_PROFISSIONAL,
    QT_MAT_CURSO_TEC)
  VALUES (
    src.NO_MUNICIPIO ,
    src.NO_AREA_CURSO_PROFISSIONAL ,
    src.NO_CURSO_EDUC_PROFISSIONAL ,
    src.QT_MAT_CURSO_TEC 
    );
    
DELETE FROM `tccfacens2024.TCC_Turismo_staging.d_Ensino_tecnico` WHERE 1 = 1;
END;



#############################################

CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_d_Localizacao`()
BEGIN


MERGE `tccfacens2024.TCC_Turismo.d_Localizacao` tgt
USING (
  select 
    NO_MUNICIPIO,
    cast(ANO_REF as integer) as ANO_REF,
    UF,
    ESTADO,
    REGIAO,
    MICRORREGIAO,
    cast(replace(POP_TOTAL,'.','') as integer) as POP_TOTAL,
    cast(replace(POP_URB,'.','') as integer) as POP_URB ,
    cast(FAIXA_POP as integer) as FAIXA_POP, 
    DESC_FAIXA,
    cast(replace(AREA_KM2,'.','') as integer) as AREA_KM2
  from `TCC_Turismo_staging.d_Localizacao`
 ) as src
ON
  tgt.NO_MUNICIPIO = src.NO_MUNICIPIO	and 
  tgt.ANO_REF = src.ANO_REF	and
  tgt.UF = src.UF and	
  tgt.ESTADO = src.ESTADO and
  tgt.REGIAO = src.REGIAO	and
  tgt.MICRORREGIAO = src.MICRORREGIAO	and
  tgt.POP_TOTAL = src.POP_TOTAL and	
  tgt.POP_URB = src.POP_URB and
  tgt.FAIXA_POP = src.FAIXA_POP	and
  tgt.DESC_FAIXA = src.DESC_FAIXA	and
  tgt.AREA_KM2 = src.AREA_KM2 

WHEN MATCHED THEN
  UPDATE SET 
    tgt.NO_MUNICIPIO = src.NO_MUNICIPIO	,
    tgt.ANO_REF = src.ANO_REF	,
    tgt.UF = src.UF	,
    tgt.ESTADO = src.ESTADO, 
    tgt.REGIAO = src.REGIAO	,
    tgt.MICRORREGIAO = src.MICRORREGIAO	,
    tgt.POP_TOTAL = src.POP_TOTAL	,
    tgt.POP_URB = src.POP_URB, 
    tgt.FAIXA_POP = src.FAIXA_POP	,
    tgt.DESC_FAIXA = src.DESC_FAIXA	,
    tgt.AREA_KM2 = src.AREA_KM2	

  
WHEN NOT MATCHED BY TARGET THEN
  INSERT (
    NO_MUNICIPIO ,
    ANO_REF,
    UF,
    ESTADO,
    REGIAO,
    MICRORREGIAO,
    POP_TOTAL,
    POP_URB,
    FAIXA_POP,
    DESC_FAIXA,
    AREA_KM2
    )
  VALUES (
    src.NO_MUNICIPIO ,
    src.ANO_REF ,
    src.UF ,
    src.ESTADO ,
    src.REGIAO ,
    src.MICRORREGIAO ,
    src.POP_TOTAL ,
    src.POP_URB ,
    src.FAIXA_POP ,
    src.DESC_FAIXA ,   
    src.AREA_KM2
    );
    
DELETE   from `TCC_Turismo_staging.d_Localizacao` WHERE 1 = 1;
END;


############################################


CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_d_Regiao_Turistica`()
BEGIN


MERGE `tccfacens2024.TCC_Turismo.d_Regiao_Turistica` tgt
USING (SELECT 
  NO_MUNICIPIO,
  REGIAO_TURISTICA,
  CATEGORIA_TURISMO
FROM `tccfacens2024.TCC_Turismo_staging.d_Regiao_Turistica` ) as src
ON
  tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO and 
  tgt.REGIAO_TURISTICA  = src.REGIAO_TURISTICA and 
  tgt.CATEGORIA_TURISMO  = src.CATEGORIA_TURISMO 

WHEN MATCHED THEN
  UPDATE SET 
    tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO,
    tgt.REGIAO_TURISTICA  = src.REGIAO_TURISTICA,
    tgt.CATEGORIA_TURISMO  = src.CATEGORIA_TURISMO 
  
WHEN NOT MATCHED BY TARGET THEN
  INSERT (
    NO_MUNICIPIO ,
    REGIAO_TURISTICA ,
    CATEGORIA_TURISMO  )
  VALUES (
    src.NO_MUNICIPIO ,
    src.REGIAO_TURISTICA ,
    src.CATEGORIA_TURISMO 
    );
    
DELETE FROM `tccfacens2024.TCC_Turismo_staging.d_Regiao_Turistica` WHERE 1 = 1;
END;


################################################


CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_d_infra_Turismo`()
BEGIN
  MERGE `tccfacens2024.TCC_Turismo.d_infra_Turismo` tgt
  USING (
    SELECT
      NO_MUNICIPIO,
      PROJETOS_MTUR,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_AGRICULTURA_E_PECUARIA,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_TURISMO,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_OUTROS,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_SERVICOS,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_COMERCIO,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_INDUSTRIA_DE_BASE,
      FUNDO_MUNICIPAL_TURISMO,
      PLANO_MUNICIPAL_TURISMO,
      PLANO_MKT_TURISMO,
      PROJETOS_ATIVIDADE_TURISTICA,
      CAST(HOSPEDAGEM_QT AS INT64) AS HOSPEDAGEM_QT,
      CAST(LEITOS_QT AS INT64) AS LEITOS_QT,
      LOCADORAS_VEICULOS,
      CAST(AGENCIAS_BANCARIAS_QT AS INT64) AS AGENCIAS_BANCARIAS_QT,
      AEROPORTO,
      TIPOS_TRANSPORTE,
      TIPOS_TRANSPORTE_RODOVIARIO,
      TIPOS_TRANSPORTE_AQUAVIARIO,
      TIPOS_TRANSPORTE_AEREO,
      TIPOS_TRANSPORTE_OUTROS,
      ACESSO_DESTINO_TURISTICO,
      ACESSO_DESTINO_TURISTICO_HIDROVIA,
      ACESSO_DESTINO_TURISTICO_RODOVIA,
      ACESSO_DESTINO_TURISTICO_AEROPORTO,
      ACESSO_DESTINO_TURISTICO_FERROVIA,
      ACESSO_DESTINO_TURISTICO_OUTROS,
      SITUACAO_SINALIZACAO,
      ROTA_TURISTICA,
      INTERLIGACAO_ENTRE_ATRATIVOS,
      SINALIZACAO_ACESSIBILIDADE,
      RESERVA_ESPACO_ACESSIBILIDADE,
      PROFISSIONAIS_ACESSIBILIDADE,
      CAST(EMPRESAS_TURISMO_QT AS INT64) AS EMPRESAS_TURISMO_QT,
      TIPOS_PATRIMONIO_NATURAL,
      TIPOS_PATRIMONIO_NATURAL_PARQUES_NATURAIS,
      TIPOS_PATRIMONIO_NATURAL_UNIDADE_DE_CONSERVACAO,
      TIPOS_PATRIMONIO_NATURAL_RESERVAS_ECOLOGICAS,
      TIPOS_PATRIMONIO_NATURAL_OUTROS,
      UNIDADES_CONSERVACAO,
      TIPOS_PATRIMONIO_CULTURAL,
      PATRIMONIO_CULTURAL_HISTORICO,
      PATRIMONIO_CULTURAL_EQUIPAMENTOS,
      PATRIMONIO_CULTURAL_OUTROS,
      BARCOS_TURISMO,
      TURISMO_PESCA,
      TURISMO_MERGULHO
    FROM `tccfacens2024.TCC_Turismo_staging.d_infra_Turismo`
  ) AS src
  ON tgt.NO_MUNICIPIO = src.NO_MUNICIPIO

  WHEN MATCHED THEN
    UPDATE SET
      tgt.NO_MUNICIPIO = src.NO_MUNICIPIO,
      tgt.PROJETOS_MTUR = src.PROJETOS_MTUR,
      tgt.PRINCIPAIS_ATIVIDADES_ECONOMICAS = src.PRINCIPAIS_ATIVIDADES_ECONOMICAS,
      tgt.PRINCIPAIS_ATIVIDADES_ECONOMICAS_AGRICULTURA_E_PECUARIA = src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_AGRICULTURA_E_PECUARIA,
      tgt.PRINCIPAIS_ATIVIDADES_ECONOMICAS_TURISMO = src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_TURISMO,
      tgt.PRINCIPAIS_ATIVIDADES_ECONOMICAS_OUTROS = src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_OUTROS,
      tgt.PRINCIPAIS_ATIVIDADES_ECONOMICAS_SERVICOS = src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_SERVICOS,
      tgt.PRINCIPAIS_ATIVIDADES_ECONOMICAS_COMERCIO = src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_COMERCIO,
      tgt.PRINCIPAIS_ATIVIDADES_ECONOMICAS_INDUSTRIA_DE_BASE = src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_INDUSTRIA_DE_BASE,
      tgt.FUNDO_MUNICIPAL_TURISMO = src.FUNDO_MUNICIPAL_TURISMO,
      tgt.PLANO_MUNICIPAL_TURISMO = src.PLANO_MUNICIPAL_TURISMO,
      tgt.PLANO_MKT_TURISMO = src.PLANO_MKT_TURISMO,
      tgt.PROJETOS_ATIVIDADE_TURISTICA = src.PROJETOS_ATIVIDADE_TURISTICA,
      tgt.HOSPEDAGEM_QT = src.HOSPEDAGEM_QT,
      tgt.LEITOS_QT = src.LEITOS_QT,
      tgt.LOCADORAS_VEICULOS = src.LOCADORAS_VEICULOS,
      tgt.AGENCIAS_BANCARIAS_QT = src.AGENCIAS_BANCARIAS_QT,
      tgt.AEROPORTO = src.AEROPORTO,
      tgt.TIPOS_TRANSPORTE = src.TIPOS_TRANSPORTE,
      tgt.TIPOS_TRANSPORTE_RODOVIARIO = src.TIPOS_TRANSPORTE_RODOVIARIO,
      tgt.TIPOS_TRANSPORTE_AQUAVIARIO = src.TIPOS_TRANSPORTE_AQUAVIARIO,
      tgt.TIPOS_TRANSPORTE_AEREO = src.TIPOS_TRANSPORTE_AEREO,
      tgt.TIPOS_TRANSPORTE_OUTROS = src.TIPOS_TRANSPORTE_OUTROS,
      tgt.ACESSO_DESTINO_TURISTICO = src.ACESSO_DESTINO_TURISTICO,
      tgt.ACESSO_DESTINO_TURISTICO_HIDROVIA = src.ACESSO_DESTINO_TURISTICO_HIDROVIA,
      tgt.ACESSO_DESTINO_TURISTICO_RODOVIA = src.ACESSO_DESTINO_TURISTICO_RODOVIA,
      tgt.ACESSO_DESTINO_TURISTICO_AEROPORTO = src.ACESSO_DESTINO_TURISTICO_AEROPORTO,
      tgt.ACESSO_DESTINO_TURISTICO_FERROVIA = src.ACESSO_DESTINO_TURISTICO_FERROVIA,
      tgt.ACESSO_DESTINO_TURISTICO_OUTROS = src.ACESSO_DESTINO_TURISTICO_OUTROS,
      tgt.SITUACAO_SINALIZACAO = src.SITUACAO_SINALIZACAO,
      tgt.ROTA_TURISTICA = src.ROTA_TURISTICA,
      tgt.INTERLIGACAO_ENTRE_ATRATIVOS = src.INTERLIGACAO_ENTRE_ATRATIVOS,
      tgt.SINALIZACAO_ACESSIBILIDADE = src.SINALIZACAO_ACESSIBILIDADE,
      tgt.RESERVA_ESPACO_ACESSIBILIDADE = src.RESERVA_ESPACO_ACESSIBILIDADE,
      tgt.PROFISSIONAIS_ACESSIBILIDADE = src.PROFISSIONAIS_ACESSIBILIDADE,
      tgt.EMPRESAS_TURISMO_QT = src.EMPRESAS_TURISMO_QT,
      tgt.TIPOS_PATRIMONIO_NATURAL = src.TIPOS_PATRIMONIO_NATURAL,
      tgt.TIPOS_PATRIMONIO_NATURAL_PARQUES_NATURAIS = src.TIPOS_PATRIMONIO_NATURAL_PARQUES_NATURAIS,
      tgt.TIPOS_PATRIMONIO_NATURAL_UNIDADE_DE_CONSERVACAO = src.TIPOS_PATRIMONIO_NATURAL_UNIDADE_DE_CONSERVACAO,
      tgt.TIPOS_PATRIMONIO_NATURAL_RESERVAS_ECOLOGICAS = src.TIPOS_PATRIMONIO_NATURAL_RESERVAS_ECOLOGICAS,
      tgt.TIPOS_PATRIMONIO_NATURAL_OUTROS = src.TIPOS_PATRIMONIO_NATURAL_OUTROS,
      tgt.UNIDADES_CONSERVACAO = src.UNIDADES_CONSERVACAO,
      tgt.TIPOS_PATRIMONIO_CULTURAL = src.TIPOS_PATRIMONIO_CULTURAL,
      tgt.PATRIMONIO_CULTURAL_HISTORICO = src.PATRIMONIO_CULTURAL_HISTORICO,
      tgt.PATRIMONIO_CULTURAL_EQUIPAMENTOS = src.PATRIMONIO_CULTURAL_EQUIPAMENTOS,
      tgt.PATRIMONIO_CULTURAL_OUTROS = src.PATRIMONIO_CULTURAL_OUTROS,
      tgt.BARCOS_TURISMO = src.BARCOS_TURISMO,
      tgt.TURISMO_PESCA = src.TURISMO_PESCA

,
      tgt.TURISMO_MERGULHO = src.TURISMO_MERGULHO

  WHEN NOT MATCHED BY TARGET THEN
    INSERT (
      NO_MUNICIPIO,
      PROJETOS_MTUR,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_AGRICULTURA_E_PECUARIA,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_TURISMO,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_OUTROS,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_SERVICOS,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_COMERCIO,
      PRINCIPAIS_ATIVIDADES_ECONOMICAS_INDUSTRIA_DE_BASE,
      FUNDO_MUNICIPAL_TURISMO,
      PLANO_MUNICIPAL_TURISMO,
      PLANO_MKT_TURISMO,
      PROJETOS_ATIVIDADE_TURISTICA,
      HOSPEDAGEM_QT,
      LEITOS_QT,
      LOCADORAS_VEICULOS,
      AGENCIAS_BANCARIAS_QT,
      AEROPORTO,
      TIPOS_TRANSPORTE,
      TIPOS_TRANSPORTE_RODOVIARIO,
      TIPOS_TRANSPORTE_AQUAVIARIO,
      TIPOS_TRANSPORTE_AEREO,
      TIPOS_TRANSPORTE_OUTROS,
      ACESSO_DESTINO_TURISTICO,
      ACESSO_DESTINO_TURISTICO_HIDROVIA,
      ACESSO_DESTINO_TURISTICO_RODOVIA,
      ACESSO_DESTINO_TURISTICO_AEROPORTO,
      ACESSO_DESTINO_TURISTICO_FERROVIA,
      ACESSO_DESTINO_TURISTICO_OUTROS,
      SITUACAO_SINALIZACAO,
      ROTA_TURISTICA,
      INTERLIGACAO_ENTRE_ATRATIVOS,
      SINALIZACAO_ACESSIBILIDADE,
      RESERVA_ESPACO_ACESSIBILIDADE,
      PROFISSIONAIS_ACESSIBILIDADE,
      EMPRESAS_TURISMO_QT,
      TIPOS_PATRIMONIO_NATURAL,
      TIPOS_PATRIMONIO_NATURAL_PARQUES_NATURAIS,
      TIPOS_PATRIMONIO_NATURAL_UNIDADE_DE_CONSERVACAO,
      TIPOS_PATRIMONIO_NATURAL_RESERVAS_ECOLOGICAS,
      TIPOS_PATRIMONIO_NATURAL_OUTROS,
      UNIDADES_CONSERVACAO,
      TIPOS_PATRIMONIO_CULTURAL,
      PATRIMONIO_CULTURAL_HISTORICO,
      PATRIMONIO_CULTURAL_EQUIPAMENTOS,
      PATRIMONIO_CULTURAL_OUTROS,
      BARCOS_TURISMO,
      TURISMO_PESCA,
      TURISMO_MERGULHO
    )
    VALUES (
      src.NO_MUNICIPIO,
      src.PROJETOS_MTUR,
      src.PRINCIPAIS_ATIVIDADES_ECONOMICAS,
      src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_AGRICULTURA_E_PECUARIA,
      src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_TURISMO,
      src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_OUTROS,
      src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_SERVICOS,
      src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_COMERCIO,
      src.PRINCIPAIS_ATIVIDADES_ECONOMICAS_INDUSTRIA_DE_BASE,
      src.FUNDO_MUNICIPAL_TURISMO,
      src.PLANO_MUNICIPAL_TURISMO,
      src.PLANO_MKT_TURISMO,
      src.PROJETOS_ATIVIDADE_TURISTICA,
      src.HOSPEDAGEM_QT,
      src.LEITOS_QT,
      src.LOCADORAS_VEICULOS,
      src.AGENCIAS_BANCARIAS_QT,
      src.AEROPORTO,
      src.TIPOS_TRANSPORTE,
      src.TIPOS_TRANSPORTE_RODOVIARIO,
      src.TIPOS_TRANSPORTE_AQUAVIARIO,
      src.TIPOS_TRANSPORTE_AEREO,
      src.TIPOS_TRANSPORTE_OUTROS,
      src.ACESSO_DESTINO_TURISTICO,
      src.ACESSO_DESTINO_TURISTICO_HIDROVIA,
      src.ACESSO_DESTINO_TURISTICO_RODOVIA,
      src.ACESSO_DESTINO_TURISTICO_AEROPORTO,
      src.ACESSO_DESTINO_TURISTICO_FERROVIA,
      src.ACESSO_DESTINO_TURISTICO_OUTROS,
      src.SITUACAO_SINALIZACAO,
      src.ROTA_TURISTICA,
      src.INTERLIGACAO_ENTRE_ATRATIVOS,
      src.SINALIZACAO_ACESSIBILIDADE,
      src.RESERVA_ESPACO_ACESSIBILIDADE,
      src.PROFISSIONAIS_ACESSIBILIDADE,
      src.EMPRESAS_TURISMO_QT,
      src.TIPOS_PATRIMONIO_NATURAL,
      src.TIPOS_PATRIMONIO_NATURAL_PARQUES_NATURAIS,
      src.TIPOS_PATRIMONIO_NATURAL_UNIDADE_DE_CONSERVACAO,
      src.TIPOS_PATRIMONIO_NATURAL_RESERVAS_ECOLOGICAS,
      src.TIPOS_PATRIMONIO_NATURAL_OUTROS,
      src.UNIDADES_CONSERVACAO,
      src.TIPOS_PATRIMONIO_CULTURAL,
      src.PATRIMONIO_CULTURAL_HISTORICO,
      src.PATRIMONIO_CULTURAL_EQUIPAMENTOS,
      src.PATRIMONIO_CULTURAL_OUTROS,
      src.BARCOS_TURISMO,
      src.TURISMO_PESCA,
      src.TURISMO_MERGULHO
    );

DELETE FROM `tccfacens2024.TCC_Turismo_staging.d_infra_Turismo` WHERE 1 = 1;

END;



#####################################



CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_d_saude`()
BEGIN


MERGE `tccfacens2024.TCC_Turismo.d_saude` tgt
USING (SELECT NO_MUNICIPIO,
cast(LEITOS_QT as Integer) as LEITOS_QT
FROM `tccfacens2024.TCC_Turismo_staging.d_saude` ) as src
ON
  tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO  

WHEN MATCHED THEN
  UPDATE SET 
    tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO,
    tgt.LEITOS_QT  = src.LEITOS_QT
  
WHEN NOT MATCHED BY TARGET THEN
  INSERT (
    NO_MUNICIPIO ,
    LEITOS_QT  )
  VALUES (
    src.NO_MUNICIPIO ,
    src.LEITOS_QT
 
    );
    
DELETE FROM `tccfacens2024.TCC_Turismo_staging.d_saude` WHERE 1 = 1;
END;



######################################


CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_variavel_dependente_visitantes_tabela_1`()
BEGIN


MERGE `tccfacens2024.TCC_Turismo.variavel_dependente_visitantes_tabela_1` tgt
USING (
  SELECT 
    NO_MUNICIPIO,
    cast(IDHM as decimal) as IDHM,
    cast(PIB_PER_CAPITA as decimal) as PIB_PER_CAPITA
FROM `tccfacens2024.TCC_Turismo_staging.variavel_dependente_visitantes_tabela_1` ) as src
ON
  tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO and 
  tgt.IDHM  = src.IDHM and  
  tgt.PIB_PER_CAPITA  = src.PIB_PER_CAPITA 
WHEN MATCHED THEN
  UPDATE SET 
    tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO,
    tgt.IDHM  = src.IDHM,
    tgt.PIB_PER_CAPITA  = src.PIB_PER_CAPITA
WHEN NOT MATCHED BY TARGET THEN
  INSERT (
    NO_MUNICIPIO ,
    IDHM,
    PIB_PER_CAPITA  )
  VALUES (
    src.NO_MUNICIPIO ,
    src.IDHM ,
    src.PIB_PER_CAPITA
    );
    
DELETE FROM `tccfacens2024.TCC_Turismo_staging.variavel_dependente_visitantes_tabela_1`  WHERE 1 = 1;

END;


#####################################



CREATE OR REPLACE PROCEDURE `tccfacens2024.TCC_Turismo.merge_variavel_dependente_visitantes_tabela_2`()
BEGIN


MERGE `tccfacens2024.TCC_Turismo.variavel_dependente_visitantes_tabela_2` tgt
USING (
  SELECT 
    NO_MUNICIPIO,
    cast(replace(VISITAS_INTERNACIONAL_QT,'.','') as integer) as VISITAS_INTERNACIONAL_QT,
    cast(replace(VISITAS_NACIONAL_QT,'.','') as integer) as VISITAS_NACIONAL_QT
FROM `tccfacens2024.TCC_Turismo_staging.variavel_dependente_visitantes_tabela_2` ) as src
ON
  tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO and 
  tgt.VISITAS_INTERNACIONAL_QT  = src.VISITAS_INTERNACIONAL_QT and  
  tgt.VISITAS_NACIONAL_QT  = src.VISITAS_NACIONAL_QT 
WHEN MATCHED THEN
  UPDATE SET 
    tgt.NO_MUNICIPIO  = src.NO_MUNICIPIO,
    tgt.VISITAS_INTERNACIONAL_QT  = src.VISITAS_INTERNACIONAL_QT,
    tgt.VISITAS_NACIONAL_QT  = src.VISITAS_NACIONAL_QT
WHEN NOT MATCHED BY TARGET THEN
  INSERT (
    NO_MUNICIPIO ,
    VISITAS_INTERNACIONAL_QT,
    VISITAS_NACIONAL_QT  )
  VALUES (
    src.NO_MUNICIPIO ,
    src.VISITAS_INTERNACIONAL_QT ,
    src.VISITAS_NACIONAL_QT
    );
    
DELETE FROM `tccfacens2024.TCC_Turismo_staging.variavel_dependente_visitantes_tabela_2`  WHERE 1 = 1;

END;


######################################

